<form version="1.1" theme="dark">
  <label>Old Fuel Prices</label>
  <description>Track fuel prices from all Providers</description>
  <search id="baseSearch">
    <query>| multisearch

[ search (index="sfxt-diesel" OR index="sfx-diesel") source="*pipeline*.csv" OR source="Proto_ContractPriceList*.csv"
| rename Sous_Total as Price, Prov as Province, Diesel as City, "No_ Site" as Location
| eval Provider="Pipeline"
]

[ search (index="sfxt-diesel" OR index="sfx-diesel") source="pcn-cad-*.csv" OR source="*bvd-ca*.csv"
| rename "FUEL PRICE" as Price, PROV as Province, "CITY" as City, SITE as Location
| eval Provider="BVD"
]

[ search (index="sfxt-diesel" OR index="sfx-diesel") source="*irving-ca*.csv" OR source="CPNRFuturePricingReportCAN*.csv"
| rename State as Province, "Site Name" as City, "Base Price" as bp, "Federal Excise Tax" as fet, "Provincial Road Tax" as prt, "Sales Tax" as st
| eval Price=sum(bp,fet,prt,st)
| eval Provider="Irving"
]

[ search (index="sfxt-diesel" OR index="sfx-diesel") source="*shell*.csv"
| rename State as Province, "Site Name" as City, Cost as bp, "Excise Tax" as fet, "PRT" as prt, "Taxes" as st, "Carbon Tax" as ct
| eval PriceA=sum(bp,fet,prt,st,ct), Price=(((Total-0.06)*bp)/Total)
| eval Provider="Shell"
]

[ search (index="sfxt-diesel" OR index="sfx-diesel") source="*flyingj-ca*.csv" OR source="cp151316*.csv"
| rename "Retail Disount" as Price, State as Province, Site as Location
| eval Provider="Flying J"
]

[ search (index="sfxt-diesel" OR index="sfx-diesel") source="pcn-usd*.csv" OR source="*bvd-us*.csv"
| rename "YOUR PRICE" as PriceUs, STATE as Province, CITY as City, SITE as Location
| eval Provider="Loves", Price=(((PriceUs/3.78451)*$exchange$)+1.50000000)
]

[ search (index="sfxt-diesel" OR index="sfx-diesel") source="*irving-us*.csv" OR source="CPNRFuturetPricingReportUSA*.csv"
| rename Total as PriceUs, State as Province, "Site Name" as City
| eval Provider="Irving US", Price=(((PriceUs/3.78451)*$exchange$)+1.50000000)
]

[ search (index="sfxt-diesel" OR index="sfx-diesel") source="*flyingj-us*.csv" OR source="cp-us-151316*.csv"
| rename "Retail Disount" as PriceUs, State as Province, Site as Location
| eval Provider="Flying J US", Price=(((PriceUs/3.78451)*$exchange$)+1.50000000)
]

| eval Date=strftime(_time, "%y-%m-%d")
| where isnotnull(Price)
| fields Date Province City Provider Location Price
</query>
    <earliest>$pricedate.earliest$</earliest>
    <latest>$pricedate.latest$</latest>
  </search>
  <fieldset submitButton="false" autoRun="true">
    <input type="text" token="exchange" searchWhenChanged="true">
      <label>Exchange Rate</label>
      <default>0.38</default>
      <initialValue>0.38</initialValue>
    </input>
    <input type="time" token="pricedate" searchWhenChanged="true">
      <label>Price Date</label>
      <default>
        <earliest>-1d@d</earliest>
        <latest>@d</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>MONCTON</title>
      <table>
        <search id="moncton" base="baseSearch">
          <query>
| search City="*MONCTON*"
| where Province="NB"
| table Date Price Location Provider City Province
| sort -Date, +Price</query>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="Price">
          <colorPalette type="list">[#118832,#CBA700,#D94E17,#D41F1F]</colorPalette>
          <scale type="threshold">1,1.6,1.9</scale>
        </format>
        <format type="number" field="Price">
          <option name="precision">3</option>
        </format>
      </table>
    </panel>
    <panel>
      <title>EDMUNDSTON, WOODSTOCK &amp; HOULTON</title>
      <table>
        <search id="woodstock" base="baseSearch">
          <query>| search City="*WOODSTOCK*" OR City="*EDMUNDSTON*" OR City="HOULTON IRVING BIG S" AND Province="ME" OR Province="NB"
| table Date Price Location Provider City Province
| sort -Date, +Price</query>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="Price">
          <colorPalette type="list">[#118832,#CBA700,#D94E17,#D41F1F]</colorPalette>
          <scale type="threshold">1,1.6,1.9</scale>
        </format>
        <format type="number" field="Price">
          <option name="precision">3</option>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>AULAC</title>
      <table>
        <search id="aulac" base="baseSearch">
          <query>

| search City="*AULAC*" AND Province="NB"
| table Date Price Location Provider City Province
| sort -Date, +Price</query>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="Price">
          <colorPalette type="list">[#118832,#CBA700,#D94E17,#D41F1F]</colorPalette>
          <scale type="threshold">1,1.6,1.9</scale>
        </format>
        <format type="number" field="Price">
          <option name="precision">3</option>
        </format>
      </table>
    </panel>
    <panel>
      <title>ENFIELD</title>
      <table>
        <search id="enfield" base="baseSearch">
          <query>

| search City="*ENFIELD*" AND Province="NS"
| table Date Price Location Provider City Province
| sort -Date, +Price</query>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="Price">
          <colorPalette type="list">[#118832,#CBA700,#D94E17,#D41F1F]</colorPalette>
          <scale type="threshold">1,1.6,1.9</scale>
        </format>
        <format type="number" field="Price">
          <option name="precision">3</option>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>BORDENTOWN</title>
      <table>
        <search id="bordentown" base="baseSearch">
          <query>

| search City="BORDENTOWN" AND Province="NJ"
| table Date Price Location Provider City Province
| sort -Date, +Price</query>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="Price">
          <colorPalette type="list">[#118832,#CBA700,#D94E17,#D41F1F]</colorPalette>
          <scale type="threshold">1,1.6,1.9</scale>
        </format>
        <format type="number" field="Price">
          <option name="precision">4</option>
        </format>
      </table>
    </panel>
    <panel>
      <title>BINGHAMTON &amp; NEW MILFORD</title>
      <table>
        <search id="binghamton" base="baseSearch">
          <query>

| search City="*BINGHAMTON*" OR City="NEW MILFORD" AND Province="NY" OR Province="PA"
| table Date Price Location Provider City Province
| sort -Date, +Price</query>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="Price">
          <colorPalette type="list">[#118832,#CBA700,#D94E17,#D41F1F]</colorPalette>
          <scale type="threshold">1,1.6,1.9</scale>
        </format>
        <format type="number" field="Price">
          <option name="precision">4</option>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>WILLINGTON</title>
      <table>
        <search id="willington" base="baseSearch">
          <query>

| search City="*WILLINGTON*" AND Province="CT"
| table Date Price Location Provider City Province
| sort -Date, +Price</query>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="Price">
          <colorPalette type="list">[#118832,#CBA700,#D94E17,#D41F1F]</colorPalette>
          <scale type="threshold">1,1.6,1.9</scale>
        </format>
        <format type="number" field="Price">
          <option name="precision">4</option>
        </format>
      </table>
    </panel>
    <panel>
      <title>NIAGARA</title>
      <table>
        <search id="niagara" base="baseSearch">
          <query>

| search City="*NIAGARA*" AND Province="ON"
| table Date Price Location Provider City Province
| sort -Date, +Price</query>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="Price">
          <colorPalette type="list">[#118832,#CBA700,#D94E17,#D41F1F]</colorPalette>
          <scale type="threshold">1,1.6,1.9</scale>
        </format>
        <format type="number" field="Price">
          <option name="precision">3</option>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>MILTON</title>
      <table>
        <search id="milton" base="baseSearch">
          <query>

| search City="MILTON" AND Province="ON"
| table Date Price Location Provider City Province
| sort -Date, +Price</query>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="Price">
          <colorPalette type="list">[#118832,#CBA700,#D94E17,#D41F1F]</colorPalette>
          <scale type="threshold">1,1.6,1.9</scale>
        </format>
        <format type="number" field="Price">
          <option name="precision">3</option>
        </format>
      </table>
    </panel>
    <panel>
      <title>MISSISSAUGA</title>
      <table>
        <search id="mississauga" base="baseSearch">
          <query>

| search City="*MISSISSAUGA*" AND Province="ON"
| table Date Price Location Provider City Province
| sort -Date, +Price</query>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="Price">
          <colorPalette type="list">[#118832,#CBA700,#D94E17,#D41F1F]</colorPalette>
          <scale type="threshold">1,1.6,1.9</scale>
        </format>
        <format type="number" field="Price">
          <option name="precision">3</option>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>BRAMPTON</title>
      <table>
        <search id="brampton" base="baseSearch">
          <query>

| search City="*BRAMPTON*" AND Province="ON"
| table Date Price Location Provider City Province
| sort -Date, +Price</query>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="Price">
          <colorPalette type="list">[#118832,#CBA700,#D94E17,#D41F1F]</colorPalette>
          <scale type="threshold">1,1.6,1.9</scale>
        </format>
        <format type="number" field="Price">
          <option name="precision">3</option>
        </format>
      </table>
    </panel>
    <panel>
      <title>KINGSTON &amp; NAPANEE</title>
      <table>
        <search id="kingston" base="baseSearch">
          <query>

| search City="*KINGSTON*" OR City="NAPANEE" AND Province="ON"
| table Date Price Location Provider City Province
| sort -Date, +Price</query>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="Price">
          <colorPalette type="list">[#118832,#CBA700,#D94E17,#D41F1F]</colorPalette>
          <scale type="threshold">1,1.6,1.9</scale>
        </format>
        <format type="number" field="Price">
          <option name="precision">3</option>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>CORNWALL &amp; LANCASTER</title>
      <table>
        <search id="cornwall" base="baseSearch">
          <query>

| search City="*CORNWAL*" OR City="LANCASTER" AND Province="ON"
| table Date Price Location Provider City Province
| sort -Date, +Price</query>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="Price">
          <colorPalette type="list">[#118832,#CBA700,#D94E17,#D41F1F]</colorPalette>
          <scale type="threshold">1,1.6,1.9</scale>
        </format>
        <format type="number" field="Price">
          <option name="precision">3</option>
        </format>
      </table>
    </panel>
    <panel>
      <title>STE JULIE &amp; ST JEAN-PORT JOLI</title>
      <table>
        <search id="julie" base="baseSearch">
          <query>| search City="*JULIE*" OR City="*ST JEAN-PORT JOLI*" AND Province="QC"
| table Date Price Location Provider City Province
| sort -Date, +Price</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="Price">
          <colorPalette type="list">[#118832,#CBA700,#D94E17,#D41F1F]</colorPalette>
          <scale type="threshold">1,1.6,1.9</scale>
        </format>
        <format type="number" field="Price">
          <option name="precision">3</option>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>PROVIDER PRICES ACROSS CITIES</title>
      <input type="dropdown" token="provider" searchWhenChanged="true">
        <label>Provider</label>
        <choice value="*">All</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>Provider</fieldForLabel>
        <fieldForValue>Provider</fieldForValue>
        <search id="provider1" base="baseSearch">
          <query>
|dedup Provider
| table Provider</query>
        </search>
      </input>
      <input type="dropdown" token="province" searchWhenChanged="true">
        <label>Province</label>
        <choice value="*">All</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>Province</fieldForLabel>
        <fieldForValue>Province</fieldForValue>
        <search id="province1" base="baseSearch">
          <query>
|search Provider="$provider$"
|dedup Province
| table Province</query>
        </search>
      </input>
      <input type="dropdown" token="city" searchWhenChanged="true">
        <label>City</label>
        <choice value="*">All</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>City</fieldForLabel>
        <fieldForValue>City</fieldForValue>
        <search id="city1" base="baseSearch">
          <query>
|search Provider="$provider$"
|dedup City
| table City</query>
        </search>
      </input>
      <table>
        <search id="fullList" base="baseSearch">
          <query>| search Provider="$provider$" Province="$province$" City="$city$"
| eval Dates=strftime(_time,"%y-%m-%d")
| table Dates Price Location Provider City Province

| sort -Dates, +Price</query>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="Price">
          <colorPalette type="list">[#118832,#CBA700,#D94E17,#D41F1F]</colorPalette>
          <scale type="threshold">1,1.6,1.9</scale>
        </format>
        <format type="number" field="Price">
          <option name="precision">3</option>
        </format>
        <drilldown>
          <condition field="Provider">
            <set token="provider-t">$row.Provider$</set>
            <set token="province">$row.Province$</set>
            <set token="city">$row.City$</set>
            <set token="enable_pop_up"></set>
            <unset token="form.hide_panel"></unset>
          </condition>
        </drilldown>
      </table>
    </panel>
  </row>
</form>
