<form version="1.1" theme="dark">
  <label>Margins</label>
  <description>Track margins across selected periods and determine the difference between the Fuel Spend and Volumes purchased.</description>
  <search id="base">
    <query>
      | savedsearch invoiceSearch exrt="$exrt$" uni="*"
</query>
    <earliest>$perioda.earliest$</earliest>
    <latest>$perioda.latest$</latest>
  </search>
  <search id="base2">
    <query>
      | savedsearch invoiceSearch exrt="$exrt$" uni="*"
</query>
    <earliest>$periodb.earliest$</earliest>
    <latest>$periodb.latest$</latest>
  </search>
  <fieldset submitButton="false" autoRun="false">
    <input type="time" token="perioda" searchWhenChanged="true">
      <label>Period A</label>
      <default>
        <earliest>-7d@w0</earliest>
        <latest>@w0</latest>
      </default>
    </input>
    <input type="time" token="periodb" searchWhenChanged="true">
      <label>Period B</label>
      <default>
        <earliest>@w0</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="text" token="exrt" searchWhenChanged="true">
      <label>Exchange Rate</label>
      <default>0.38</default>
      <initialValue>0.38</initialValue>
    </input>
    <input type="dropdown" token="prov" searchWhenChanged="true">
      <label>Provider</label>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
      <fieldForLabel>Provider</fieldForLabel>
      <fieldForValue>Provider</fieldForValue>
      <search id="provider" base="base">
        <query>
| dedup Provider
| table Provider</query>
      </search>
    </input>
    <input type="dropdown" token="provin" searchWhenChanged="true">
      <label>Province</label>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
      <fieldForLabel>Province</fieldForLabel>
      <fieldForValue>Province</fieldForValue>
      <search id="province" base="base">
        <query>
| search Provider ="$prov$"
| dedup Province
| table Province</query>
      </search>
    </input>
    <input type="dropdown" token="cit" searchWhenChanged="true">
      <label>City</label>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
      <fieldForLabel>City</fieldForLabel>
      <fieldForValue>City</fieldForValue>
      <search id="city" base="base">
        <query>
| search Provider ="$prov$"
| dedup City
| table City</query>
      </search>
    </input>
    <input type="dropdown" token="country" searchWhenChanged="true">
      <label>Country</label>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
      <fieldForLabel>Country</fieldForLabel>
      <fieldForValue>Country</fieldForValue>
      <search id="country" base="base">
        <query>| search Provider ="$prov$"
| dedup Country
| table Country</query>
      </search>
    </input>
  </fieldset>
  <row>
    <panel>
      <single>
        <title>PERIOD A FUEL SPEND</title>
        <search id="overage" base="base">
          <query>| search Liters &gt; 0.0
| stats sum(Price)</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0.000</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">Spent over Period A</option>
        <option name="unit">$</option>
        <option name="unitPosition">before</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>PERIOD A FUEL VOLUME</title>
        <search id="volume" base="base">
          <query>| search Liters &gt; 0.0
| eval oQuantity=(Liters-190)
| stats sum(Liters)</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0.000</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="rangeValues">[0,200,300,400]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">Fueled over Period A</option>
        <option name="unit">Liters</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>PERIOD B FUEL SPEND</title>
        <search id="overage2" base="base2">
          <query>| search Liters &gt; 0.0
| stats sum(Price)</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0.000</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">Spent over Period B</option>
        <option name="unit">$</option>
        <option name="unitPosition">before</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>PERIOD B FUEL VOLUME</title>
        <search id="volume2" base="base2">
          <query>| search Liters &gt; 0.0
| eval oQuantity=(Liters-190)
| stats sum(Liters)</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0.000</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="rangeValues">[0,200,300,400]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">Fueled over Period B</option>
        <option name="unit">Liters</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>
</form>
